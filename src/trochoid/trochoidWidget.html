<!-- Bootstrap (nur einmal pro Seite einbinden) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" /><!-- KaTeX (nur einmal pro Seite einbinden) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
<script defer="defer" src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script> 
<script defer="defer" src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" onload=
"renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'\\(',right:'\\)',display:false}]});"></script>
<div class="container my-4" id="cyc-widget">
    <div class="row">
        <div class="col-12">
            <h3 class="mb-3">
                Trochoid
            </h3>
        </div>
        <!-- Formeln -->

        <div class="col-12 col-lg-10">
            <p class="mb-2 fw-semibold">
                Trochoid (point at distance \(d\) from the rolling circle center)
            </p>
            $$ x(\theta,\varphi)=R\,\theta - d\,\sin\!\bigl(\theta-\varphi\bigr),\qquad y(\theta,\varphi)=R - d\,\cos\!\bigl(\theta-\varphi\bigr). $$
            <p class="mb-2 fw-semibold">
                Cycloid (special case \(d=R\), \(\varphi=0\))
            </p>
            $$ x(\theta)=R\!\left(\theta - \sin(\theta)\right),\qquad y(\theta)=R\!\left(1 - \cos(\theta)\right). $$
        </div>
    </div>

    <div class="row mt-4">
        <!-- Controls (links) -->

        <div class="col-12 col-md-4 mb-4">
            <div class="p-3 bg-white rounded shadow-sm">
                <!-- R -->

                <div class="mb-3">
                    <label for="cyc-R" class="form-label">Rolling radius \(R\)</label>
                    <div class="row gx-2 align-items-center">
                        <div class="col">
                            <input type="range" id="cyc-R" class="form-range" min="0.2" max="3" step="0.01" value="1.00" />
                        </div>

                        <div class="col-auto" style="width:6rem;">
                            <input type="number" id="cyc-R-num" class="form-control" min="0.2" max="3" step="0.01" value="1.00" />
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="cyc-d" class="form-label">Distance \(d\)</label>
                    <div class="row gx-2 align-items-center">
                        <div class="col">
                            <input type="range" id="cyc-d" class="form-range" min="0" max="2.00" step="0.01" value="1.00" />
                        </div>

                        <div class="col-auto" style="width:6rem;">
                            <input type="number" id="cyc-d-num" class="form-control" min="0" max="2.00" step="0.01" value="1.00" />
                        </div>
                    </div>
                </div>
                <!-- φ (Offset am Rad, in Grad) -->

                <div class="mb-3">
                    <label for="cyc-phi" class="form-label">Point angle \( \varphi \) (degrees)</label>
                    <div class="row gx-2 align-items-center">
                        <div class="col">
                            <input type="range" id="cyc-phi" class="form-range" min="0" max="360" step="1" value="0" />
                        </div>

                        <div class="col-auto" style="width:5rem;">
                            <input type="number" id="cyc-phi-num" class="form-control" min="0" max="360" step="1" value="0" />
                        </div>
                    </div>
                </div>
                <!-- θ (Roll-/Positionsparameter in Rad) -->

                <div class="mb-0">
                    <label for="cyc-theta-roll" class="form-label">Position \( \theta \in [0,\,4\pi] \)</label>
                    <div class="row gx-2 align-items-center">
                        <div class="col">
                            <input type="range" id="cyc-theta-roll" class="form-range" min="0" max="12.56" step="0.01" value="0" />
                        </div>

                        <div class="col-auto" style="width:6rem;">
                            <input type="number" id="cyc-theta-roll-num" class="form-control" min="0" max="12.56" step="0.01" value="0" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- iFrame (rechts) -->
        <!-- iFrame (rechts) -->

        <div class="col-12 col-md-8 d-flex flex-column align-items-center">
            <div class="ratio ratio-16x9 mb-2" style="max-width: 900px; width: 100%;">
                <iframe id="cyc-frame" class="w-100 h-100 border-0" allowfullscreen="allowfullscreen" name="cyc-frame"></iframe>
            </div>

            <ul class="mb-0">
                <li>
                    <strong>Mouse wheel</strong>: zoom
                </li>
            </ul>
        </div>
    </div>
</div>
<script>
/* <![CDATA[ */
window.addEventListener('DOMContentLoaded', () => {
  const frame = document.getElementById('cyc-frame');
  frame.src = "https://yannick168.github.io/Bachelorarbeit/src/trochoid/trochoid.html?v=" + Date.now();

  const els = {
    R:    document.getElementById('cyc-R'),
    RNum: document.getElementById('cyc-R-num'),
    d:    document.getElementById('cyc-d'),
    dNum: document.getElementById('cyc-d-num'),
    phi:    document.getElementById('cyc-phi'),
    phiNum: document.getElementById('cyc-phi-num'),
    thetaRoll:    document.getElementById('cyc-theta-roll'),
    thetaRollNum: document.getElementById('cyc-theta-roll-num'),
  };

  const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

  // d-Max an R koppeln (0 … 2R)
  function updateDRange() {
    const Rval = parseFloat(els.RNum.value);
    const newMax = (isFinite(Rval) ? 2 * Rval : 2.0);
    els.d.max = String(newMax);
    els.dNum.max = String(newMax);
    const dVal = clamp(parseFloat(els.dNum.value), parseFloat(els.d.min), newMax);
    els.dNum.value = Number.isFinite(dVal) ? dVal.toFixed(2) : els.d.min;
    els.d.value = els.dNum.value;
  }

  function postUpdate() {
    const R   = parseFloat(els.RNum.value);
    const d   = parseFloat(els.dNum.value);
    const phi = parseFloat(els.phiNum.value);
    const theta = parseFloat(els.thetaRollNum.value);
    if ([R,d,phi,theta].every(Number.isFinite)) {
      frame.contentWindow?.postMessage({ type:'update', theta, phi, d, R }, '*');
    }
  }

  function bindPair(rangeEl, numEl, opts={decimals:2}) {
    const decs = opts.decimals ?? 2;
    rangeEl.addEventListener('input', () => {
      numEl.value = Number(rangeEl.value).toFixed(decs);
      if (rangeEl === els.R) updateDRange();
      postUpdate();
    });
    numEl.addEventListener('input', () => {
      rangeEl.value = numEl.value;
      if (rangeEl === els.R) updateDRange();
      postUpdate();
    });
  }

  bindPair(els.R,   els.RNum,   {decimals:2});
  bindPair(els.d,   els.dNum,   {decimals:2});
  bindPair(els.phi, els.phiNum, {decimals:0});
  bindPair(els.thetaRoll, els.thetaRollNum, {decimals:2});

  updateDRange();
  setTimeout(postUpdate, 300);
});
/*]]>*/
</script>