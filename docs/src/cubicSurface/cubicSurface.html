<script>
  // Erwartet global: window.ctx { gl, program }, drawScene(ctx), und Uniform 'uCoeffs'
  window.addEventListener('message', (e) => {
    const data = e.data;
    if (!data || data.type !== 'updateCubicSurface') return;

    const gl = window.ctx?.gl;
    const program = window.ctx?.program;
    if (!gl || !program) return;

    // View/Surface UI spiegeln (falls vorhanden)
    const viewSel = document.getElementById('viewMode');
    const surfSel = document.getElementById('surfaceMode');
    if (viewSel && data.view) viewSel.value = String(data.view);
    if (surfSel && data.surface) surfSel.value = String(data.surface);

    // Koeffizienten-Uniform setzen
    if (Array.isArray(data.coeffs) && data.coeffs.length === 20) {
      const coeffLoc = gl.getUniformLocation(program, 'uCoeffs');
      if (coeffLoc) {
        gl.useProgram(program);
        gl.uniform1fv(coeffLoc, new Float32Array(data.coeffs));
      }
      // Falls du zusÃ¤tzlich lokale Inputs hast, spiegeln:
      if (globalThis.getUserCoeffs?.inputs) {
        data.coeffs.forEach((v, i) => {
          const el = globalThis.getUserCoeffs.inputs[i];
          if (el) el.value = String(v);
        });
      }
    }

    // Neu zeichnen
    if (window.drawScene && window.ctx) window.drawScene(window.ctx);
  });
</script>
