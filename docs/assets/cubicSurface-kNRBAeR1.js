import"./modulepreload-polyfill-B5Qt9EMX.js";import{A as E,E as H,c as p,i as F,o as W,b as g,t as L,d as U,s as z,m as b,a as _,e as X}from"./mat4-DousPgjw.js";import{c as $,f as T,d as N,a as S,b as G,n as O,l as j}from"./vec3-Er0YIGI6.js";function k(){var e=new E(9);return E!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function K(){var e=new E(4);return E!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Q(e,r){var t=r[0],n=r[1],o=r[2],i=r[3],s=t*t+n*n+o*o+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t*s,e[1]=n*s,e[2]=o*s,e[3]=i*s,e}(function(){var e=K();return function(r,t,n,o,i,s){var a,c;for(t||(t=4),n||(n=0),o?c=Math.min(o*t+n,r.length):c=r.length,a=n;a<c;a+=t)e[0]=r[a],e[1]=r[a+1],e[2]=r[a+2],e[3]=r[a+3],i(e,e,s),r[a]=e[0],r[a+1]=e[1],r[a+2]=e[2],r[a+3]=e[3];return r}})();function M(){var e=new E(4);return E!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function q(e,r,t){t=t*.5;var n=Math.sin(t);return e[0]=n*r[0],e[1]=n*r[1],e[2]=n*r[2],e[3]=Math.cos(t),e}function Z(e,r,t){var n=r[0],o=r[1],i=r[2],s=r[3],a=t[0],c=t[1],f=t[2],l=t[3];return e[0]=n*l+s*a+o*f-i*c,e[1]=o*l+s*c+i*a-n*f,e[2]=i*l+s*f+n*c-o*a,e[3]=s*l-n*a-o*c-i*f,e}function P(e,r,t,n){var o=r[0],i=r[1],s=r[2],a=r[3],c=t[0],f=t[1],l=t[2],u=t[3],d,m,v,h,y;return m=o*c+i*f+s*l+a*u,m<0&&(m=-m,c=-c,f=-f,l=-l,u=-u),1-m>H?(d=Math.acos(m),v=Math.sin(d),h=Math.sin((1-n)*d)/v,y=Math.sin(n*d)/v):(h=1-n,y=n),e[0]=h*o+y*c,e[1]=h*i+y*f,e[2]=h*s+y*l,e[3]=h*a+y*u,e}function J(e,r){var t=r[0]+r[4]+r[8],n;if(t>0)n=Math.sqrt(t+1),e[3]=.5*n,n=.5/n,e[0]=(r[5]-r[7])*n,e[1]=(r[6]-r[2])*n,e[2]=(r[1]-r[3])*n;else{var o=0;r[4]>r[0]&&(o=1),r[8]>r[o*3+o]&&(o=2);var i=(o+1)%3,s=(o+2)%3;n=Math.sqrt(r[o*3+o]-r[i*3+i]-r[s*3+s]+1),e[o]=.5*n,n=.5/n,e[3]=(r[i*3+s]-r[s*3+i])*n,e[i]=(r[i*3+o]+r[o*3+i])*n,e[s]=(r[s*3+o]+r[o*3+s])*n}return e}var D=Q;(function(){var e=$(),r=T(1,0,0),t=T(0,1,0);return function(n,o,i){var s=N(o,i);return s<-.999999?(S(e,r,o),G(e)<1e-6&&S(e,t,o),O(e,e),q(n,e,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(S(e,o,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+s,D(n,n))}})();(function(){var e=M(),r=M();return function(t,n,o,i,s,a){return P(e,n,s,a),P(r,o,i,a),P(t,e,r,2*a*(1-a)),t}})();(function(){var e=k();return function(r,t,n,o){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-t[0],e[5]=-t[1],e[8]=-t[2],D(r,J(r,e))}})();function Y(){var e=new E(2);return E!=Float32Array&&(e[0]=0,e[1]=0),e}function x(e,r){var t=new E(2);return t[0]=e,t[1]=r,t}function ee(e,r){return e[0]=r[0],e[1]=r[1],e}function re(e,r,t){return e[0]=r,e[1]=t,e}(function(){var e=Y();return function(r,t,n,o,i,s){var a,c;for(t||(t=2),n||(n=0),o?c=Math.min(o*t+n,r.length):c=r.length,a=n;a<c;a+=t)e[0]=r[a],e[1]=r[a+1],i(e,e,s),r[a]=e[0],r[a+1]=e[1];return r}})();function V(e){const r=window.innerWidth,t=window.innerHeight,n=16/9;let o=r,i=r/n;i>t&&(i=t,o=t*n),e.width=o*window.devicePixelRatio,e.height=i*window.devicePixelRatio,e.style.width=`${o}px`,e.style.height=`${i}px`,e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)"}async function B(e){return await(await fetch(e)).text()}function I(e,r,t){const n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n)||"Shader compile error");return n}function ne(e,r,t){const n=I(e,e.VERTEX_SHADER,r),o=I(e,e.FRAGMENT_SHADER,t),i=e.createProgram();if(e.attachShader(i,n),e.attachShader(i,o),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(i)||"Program link error");return i}const w=3;function te(e,r){const t=new Float32Array([-3,-3,-3,w,-3,-3,-3,w,-3,w,w,-3,-3,-3,w,w,-3,w,-3,w,w,w,w,w]),n=new Uint16Array([0,2,1,1,2,3,4,5,6,6,5,7,0,5,4,0,1,5,2,6,7,2,7,3,7,1,3,7,5,1,0,6,2,0,4,6]),o=e.createVertexArray();e.bindVertexArray(o);const i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW);const s=e.getAttribLocation(r,"aPosition");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,3,e.FLOAT,!1,0,0);const a=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW),{vao:o,iboSize:n.length}}function C(e,r){const t=e.canvas,n=t.clientWidth,o=t.clientHeight,i=(2*r[0]-n)/n,s=(o-2*r[1])/o,a=1-i*i-s*s,c=a>0?Math.sqrt(a):0;return T(i,s,c)}function oe(e,r){const t=$();if(S(t,e,r),j(t)<1e-5)return M();O(t,t);const n=Math.max(-1,Math.min(1,N(e,r))),o=Math.acos(n);return q(M(),t,o)}function R(e){const r=e.gl,t=e.program;r.uniformMatrix4fv(r.getUniformLocation(t,"uProjection"),!1,e.projection),r.uniformMatrix4fv(r.getUniformLocation(t,"uModelView"),!1,e.modelView);const n=X(p(),e.modelView);r.uniformMatrix4fv(r.getUniformLocation(t,"uModelInverse"),!1,n),r.uniform1i(r.getUniformLocation(t,"uSurface"),e.curSurface),r.uniform1i(r.getUniformLocation(t,"uOrthographic"),e.viewMode===2?1:0),r.bindVertexArray(e.cube.vao),r.drawElements(r.TRIANGLES,e.cube.iboSize,r.UNSIGNED_SHORT,0)}function A(e){const r=e.gl;r.viewport(0,0,r.canvas.width,r.canvas.height),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);const t=r.canvas.width/r.canvas.height,n=10,o=100,i=30,s=t*i;let a=0,c=0,f=50;if(F(e.projection),F(e.modelView),e.viewMode===2)W(e.projection,-s/2,s/2,-30/2,i/2,n,o);else{const u=n*(-s/2-a)/f,d=n*(s/2-a)/f,m=n*(-30/2-c)/f,v=n*(i/2-c)/f;g(e.projection,u,d,m,v,n,o)}L(e.modelView,e.modelView,[-0,-0,-50]);const l=U(p(),e.qNow);if(z(l,l,[e.zoom*15,e.zoom*15,e.zoom*15]),b(e.modelView,e.modelView,l),R(e),e.viewMode===3){const d=U(p(),e.qNow);z(d,d,[e.zoom*15,e.zoom*15,e.zoom*15]),r.colorMask(!0,!1,!1,!0);const m=p(),v=p();g(m,n*(-s/2-1.5)/f,n*(s/2-1.5)/f,n*(-30/2-c)/f,n*(i/2-c)/f,n,o),L(v,v,[-1.5,-0,-50]),b(e.modelView,v,d),_(e.projection,m),R(e),r.clear(r.DEPTH_BUFFER_BIT),r.colorMask(!1,!0,!0,!0);const h=p(),y=p();g(h,n*(-s/2+1.5)/f,n*(s/2+1.5)/f,n*(-30/2-c)/f,n*(i/2-c)/f,n,o),L(y,y,[1.5,-0,-50]),b(e.modelView,y,d),_(e.projection,h),R(e),r.colorMask(!0,!0,!0,!0)}}window.addEventListener("load",async()=>{var l;const e=document.getElementById("glcanvas"),r=e.getContext("webgl2");V(e),r.viewport(0,0,e.width,e.height);const t=await B("cubicSurface.vs.glsl"),n=await B("cubicSurface.fs.glsl"),o=ne(r,t,n);r.useProgram(o);const i=r.getUniformLocation(o,"uCoeffs"),s=te(r,o),a={gl:r,program:o,cube:s,projection:p(),modelView:p(),qNow:M(),mousePos:Y(),mousePressed:!1,zoom:1,viewMode:1,curSurface:1};window.ctx=a,r.clearColor(.5,.5,.5,1),r.enable(r.DEPTH_TEST),r.enable(r.CULL_FACE);const c=(l=window.getUserCoeffs)==null?void 0:l.call(window);(c==null?void 0:c.length)===20&&r.uniform1fv(i,new Float32Array(c)),e.addEventListener("mousedown",u=>{a.mousePressed=!0,re(a.mousePos,u.clientX,u.clientY)}),e.addEventListener("mouseup",()=>a.mousePressed=!1),e.addEventListener("mousemove",u=>{if(!a.mousePressed)return;const d=x(u.clientX,u.clientY),m=C(r,a.mousePos),v=C(r,d),h=oe(m,v);Z(a.qNow,h,a.qNow),ee(a.mousePos,d),A(a)}),e.addEventListener("wheel",u=>{a.zoom*=u.deltaY>0?1/1.1:1.1,A(a)}),document.getElementById("viewMode").addEventListener("change",u=>{a.viewMode=parseInt(u.target.value),A(a)}),document.getElementById("surfaceMode").addEventListener("change",u=>{a.curSurface=parseInt(u.target.value),A(a)});function f(){A(a),requestAnimationFrame(f)}window.addEventListener("resize",()=>{V(e),r.viewport(0,0,e.width,e.height)}),f(),window.addEventListener("message",u=>{const d=u.data;if(d.type==="updateCubicSurface"){a.viewMode=d.viewMode,a.curSurface=d.surfaceMode;const m=r.getUniformLocation(a.program,"uCoeffs");m&&Array.isArray(d.coeffs)&&d.coeffs.length===20&&(r.useProgram(a.program),r.uniform1fv(m,new Float32Array(d.coeffs))),A(a)}})});
