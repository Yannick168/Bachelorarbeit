import"./modulepreload-polyfill-B5Qt9EMX.js";import{A as g,E as X,c as y,i as U,o as G,b as L,t as P,d as C,s as I,m as z,a as _,e as j}from"./mat4-DousPgjw.js";import{c as q,f as T,d as x,a as b,b as k,n as D,l as K}from"./vec3-Er0YIGI6.js";function Q(){var e=new g(9);return g!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Z(){var e=new g(4);return g!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function J(e,n){var t=n[0],r=n[1],o=n[2],a=n[3],s=t*t+r*r+o*o+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=t*s,e[1]=r*s,e[2]=o*s,e[3]=a*s,e}(function(){var e=Z();return function(n,t,r,o,a,s){var i,c;for(t||(t=4),r||(r=0),o?c=Math.min(o*t+r,n.length):c=n.length,i=r;i<c;i+=t)e[0]=n[i],e[1]=n[i+1],e[2]=n[i+2],e[3]=n[i+3],a(e,e,s),n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3];return n}})();function S(){var e=new g(4);return g!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Y(e,n,t){t=t*.5;var r=Math.sin(t);return e[0]=r*n[0],e[1]=r*n[1],e[2]=r*n[2],e[3]=Math.cos(t),e}function ee(e,n,t){var r=n[0],o=n[1],a=n[2],s=n[3],i=t[0],c=t[1],f=t[2],l=t[3];return e[0]=r*l+s*i+o*f-a*c,e[1]=o*l+s*c+a*i-r*f,e[2]=a*l+s*f+r*c-o*i,e[3]=s*l-r*i-o*c-a*f,e}function R(e,n,t,r){var o=n[0],a=n[1],s=n[2],i=n[3],c=t[0],f=t[1],l=t[2],u=t[3],d,m,v,h,p;return m=o*c+a*f+s*l+i*u,m<0&&(m=-m,c=-c,f=-f,l=-l,u=-u),1-m>X?(d=Math.acos(m),v=Math.sin(d),h=Math.sin((1-r)*d)/v,p=Math.sin(r*d)/v):(h=1-r,p=r),e[0]=h*o+p*c,e[1]=h*a+p*f,e[2]=h*s+p*l,e[3]=h*i+p*u,e}function ne(e,n){var t=n[0]+n[4]+n[8],r;if(t>0)r=Math.sqrt(t+1),e[3]=.5*r,r=.5/r,e[0]=(n[5]-n[7])*r,e[1]=(n[6]-n[2])*r,e[2]=(n[1]-n[3])*r;else{var o=0;n[4]>n[0]&&(o=1),n[8]>n[o*3+o]&&(o=2);var a=(o+1)%3,s=(o+2)%3;r=Math.sqrt(n[o*3+o]-n[a*3+a]-n[s*3+s]+1),e[o]=.5*r,r=.5/r,e[3]=(n[a*3+s]-n[s*3+a])*r,e[a]=(n[a*3+o]+n[o*3+a])*r,e[s]=(n[s*3+o]+n[o*3+s])*r}return e}var H=J;(function(){var e=q(),n=T(1,0,0),t=T(0,1,0);return function(r,o,a){var s=x(o,a);return s<-.999999?(b(e,n,o),k(e)<1e-6&&b(e,t,o),D(e,e),Y(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(b(e,o,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,H(r,r))}})();(function(){var e=S(),n=S();return function(t,r,o,a,s,i){return R(e,r,s,i),R(n,o,a,i),R(t,e,n,2*i*(1-i)),t}})();(function(){var e=Q();return function(n,t,r,o){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-t[0],e[5]=-t[1],e[8]=-t[2],H(n,ne(n,e))}})();function W(){var e=new g(2);return g!=Float32Array&&(e[0]=0,e[1]=0),e}function re(e,n){var t=new g(2);return t[0]=e,t[1]=n,t}function te(e,n){return e[0]=n[0],e[1]=n[1],e}function oe(e,n,t){return e[0]=n,e[1]=t,e}(function(){var e=W();return function(n,t,r,o,a,s){var i,c;for(t||(t=2),r||(r=0),o?c=Math.min(o*t+r,n.length):c=n.length,i=r;i<c;i+=t)e[0]=n[i],e[1]=n[i+1],a(e,e,s),n[i]=e[0],n[i+1]=e[1];return n}})();const ae=document.getElementById("coeffContainer"),ie=["x³","y³","z³","x²y","x²z","y²z","yz²","xy²","xz²","xyz","x²","y²","z²","xz","xy","yz","x","y","z","1"],A=[0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,-1],M=[];for(let e=0;e<20;e++){const n=document.createElement("div");n.className="coeff-group";const t=document.createElement("label");t.textContent=`${ie[e]}: `;const r=document.createElement("input");r.type="number",r.value=A[e].toString(),r.step="0.1";const o=document.createElement("input");o.type="range",o.min=(A[e]-10).toString(),o.max=(A[e]+10).toString(),o.step="0.1",o.value=A[e].toString(),r.addEventListener("input",()=>{const a=parseFloat(r.value)||0;o.min=(a-5).toFixed(1),o.max=(a+5).toFixed(1),o.value=a.toString(),B()}),o.addEventListener("input",()=>{r.value=o.value,B()}),n.appendChild(t),n.appendChild(r),n.appendChild(o),ae.appendChild(n),M.push(r)}globalThis.getUserCoeffs=()=>M.map(e=>parseFloat(e.value)||0);globalThis.getUserCoeffs.inputs=M;function B(){var o,a;const e=M.map(s=>parseFloat(s.value)||0),n=(o=window.ctx)==null?void 0:o.gl,t=(a=window.ctx)==null?void 0:a.program,r=n==null?void 0:n.getUniformLocation(t,"uCoeffs");n&&t&&r&&(n.useProgram(t),n.uniform1fv(r,new Float32Array(e)),window.ctx&&window.drawScene&&window.drawScene(window.ctx))}function V(e){const n=window.innerWidth,t=window.innerHeight,r=16/9;let o=n,a=n/r;a>t&&(a=t,o=t*r),e.width=o*window.devicePixelRatio,e.height=a*window.devicePixelRatio,e.style.width=`${o}px`,e.style.height=`${a}px`,e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)"}async function $(e){return await(await fetch(e)).text()}function N(e,n,t){const r=e.createShader(n);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r)||"Shader compile error");return r}function se(e,n,t){const r=N(e,e.VERTEX_SHADER,n),o=N(e,e.FRAGMENT_SHADER,t),a=e.createProgram();if(e.attachShader(a,r),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(a)||"Program link error");return a}const w=3;function ce(e,n){const t=new Float32Array([-3,-3,-3,w,-3,-3,-3,w,-3,w,w,-3,-3,-3,w,w,-3,w,-3,w,w,w,w,w]),r=new Uint16Array([0,2,1,1,2,3,4,5,6,6,5,7,0,5,4,0,1,5,2,6,7,2,7,3,7,1,3,7,5,1,0,6,2,0,4,6]),o=e.createVertexArray();e.bindVertexArray(o);const a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW);const s=e.getAttribLocation(n,"aPosition");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,3,e.FLOAT,!1,0,0);const i=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW),{vao:o,iboSize:r.length}}function O(e,n){const t=e.canvas,r=t.clientWidth,o=t.clientHeight,a=(2*n[0]-r)/r,s=(o-2*n[1])/o,i=1-a*a-s*s,c=i>0?Math.sqrt(i):0;return T(a,s,c)}function fe(e,n){const t=q();if(b(t,e,n),K(t)<1e-5)return S();D(t,t);const r=Math.max(-1,Math.min(1,x(e,n))),o=Math.acos(r);return Y(S(),t,o)}function F(e){const n=e.gl,t=e.program;n.uniformMatrix4fv(n.getUniformLocation(t,"uProjection"),!1,e.projection),n.uniformMatrix4fv(n.getUniformLocation(t,"uModelView"),!1,e.modelView);const r=j(y(),e.modelView);n.uniformMatrix4fv(n.getUniformLocation(t,"uModelInverse"),!1,r),n.uniform1i(n.getUniformLocation(t,"uSurface"),e.curSurface),n.uniform1i(n.getUniformLocation(t,"uOrthographic"),e.viewMode===2?1:0),n.bindVertexArray(e.cube.vao),n.drawElements(n.TRIANGLES,e.cube.iboSize,n.UNSIGNED_SHORT,0)}function E(e){const n=e.gl;n.viewport(0,0,n.canvas.width,n.canvas.height),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);const t=n.canvas.width/n.canvas.height,r=10,o=100,a=30,s=t*a;let i=0,c=0,f=50;if(U(e.projection),U(e.modelView),e.viewMode===2)G(e.projection,-s/2,s/2,-30/2,a/2,r,o);else{const u=r*(-s/2-i)/f,d=r*(s/2-i)/f,m=r*(-30/2-c)/f,v=r*(a/2-c)/f;L(e.projection,u,d,m,v,r,o)}P(e.modelView,e.modelView,[-0,-0,-50]);const l=C(y(),e.qNow);if(I(l,l,[e.zoom*15,e.zoom*15,e.zoom*15]),z(e.modelView,e.modelView,l),F(e),e.viewMode===3){const d=C(y(),e.qNow);I(d,d,[e.zoom*15,e.zoom*15,e.zoom*15]),n.colorMask(!0,!1,!1,!0);const m=y(),v=y();L(m,r*(-s/2-1.5)/f,r*(s/2-1.5)/f,r*(-30/2-c)/f,r*(a/2-c)/f,r,o),P(v,v,[-1.5,-0,-50]),z(e.modelView,v,d),_(e.projection,m),F(e),n.clear(n.DEPTH_BUFFER_BIT),n.colorMask(!1,!0,!0,!0);const h=y(),p=y();L(h,r*(-s/2+1.5)/f,r*(s/2+1.5)/f,r*(-30/2-c)/f,r*(a/2-c)/f,r,o),P(p,p,[1.5,-0,-50]),z(e.modelView,p,d),_(e.projection,h),F(e),n.colorMask(!0,!0,!0,!0)}}window.addEventListener("load",async()=>{var l;const e=document.getElementById("glcanvas"),n=e.getContext("webgl2");V(e),n.viewport(0,0,e.width,e.height);const t=await $("cubicSurface.vs.glsl"),r=await $("cubicSurface.fs.glsl"),o=se(n,t,r);n.useProgram(o);const a=n.getUniformLocation(o,"uCoeffs"),s=ce(n,o),i={gl:n,program:o,cube:s,projection:y(),modelView:y(),qNow:S(),mousePos:W(),mousePressed:!1,zoom:.5,viewMode:1,curSurface:1};window.ctx=i,n.clearColor(.5,.5,.5,1),n.enable(n.DEPTH_TEST),n.enable(n.CULL_FACE);const c=(l=window.getUserCoeffs)==null?void 0:l.call(window);(c==null?void 0:c.length)===20&&n.uniform1fv(a,new Float32Array(c)),e.addEventListener("mousedown",u=>{i.mousePressed=!0,oe(i.mousePos,u.clientX,u.clientY)}),e.addEventListener("mouseup",()=>i.mousePressed=!1),e.addEventListener("mousemove",u=>{if(!i.mousePressed)return;const d=re(u.clientX,u.clientY),m=O(n,i.mousePos),v=O(n,d),h=fe(m,v);ee(i.qNow,h,i.qNow),te(i.mousePos,d),E(i)}),e.addEventListener("wheel",u=>{i.zoom*=u.deltaY>0?1/1.1:1.1,E(i)}),document.getElementById("viewMode").addEventListener("change",u=>{i.viewMode=parseInt(u.target.value),E(i)}),document.getElementById("surfaceMode").addEventListener("change",u=>{i.curSurface=parseInt(u.target.value),E(i)});function f(){E(i),requestAnimationFrame(f)}window.addEventListener("resize",()=>{V(e),n.viewport(0,0,e.width,e.height)}),f()});
