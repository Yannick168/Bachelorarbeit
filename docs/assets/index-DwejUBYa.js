(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();function Y(r,e,a){const t=r.createShader(e);if(r.shaderSource(t,a),r.compileShader(t),!r.getShaderParameter(t,r.COMPILE_STATUS)){const n=r.getShaderInfoLog(t);throw r.deleteShader(t),new Error("Shader compile error: "+n)}return t}function $(r,e,a){const t=r.createProgram();if(r.attachShader(t,e),r.attachShader(t,a),r.linkProgram(t),!r.getProgramParameter(t,r.LINK_STATUS)){const n=r.getProgramInfoLog(t);throw r.deleteProgram(t),new Error("Program link error: "+n)}return t}const J=`#version 300 es
layout(location=0) in vec3 aPosition;
layout(location=1) in vec4 aColor;

uniform mat4 uMVP;

out vec4 vColor;

void main() {
  gl_Position = uMVP * vec4(aPosition, 1.0);
  vColor = aColor;
}
`,Q=`#version 300 es
precision mediump float;


in vec4 vColor;
out vec4 fColor;

void main() {
  fColor = vColor; 
}
`;var I=1e-6,L=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function g(){var r=new L(16);return L!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Z(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function rr(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function _(r,e,a){var t=e[0],n=e[1],c=e[2],i=e[3],s=e[4],l=e[5],f=e[6],d=e[7],m=e[8],M=e[9],h=e[10],P=e[11],R=e[12],E=e[13],S=e[14],x=e[15],v=a[0],y=a[1],p=a[2],A=a[3];return r[0]=v*t+y*s+p*m+A*R,r[1]=v*n+y*l+p*M+A*E,r[2]=v*c+y*f+p*h+A*S,r[3]=v*i+y*d+p*P+A*x,v=a[4],y=a[5],p=a[6],A=a[7],r[4]=v*t+y*s+p*m+A*R,r[5]=v*n+y*l+p*M+A*E,r[6]=v*c+y*f+p*h+A*S,r[7]=v*i+y*d+p*P+A*x,v=a[8],y=a[9],p=a[10],A=a[11],r[8]=v*t+y*s+p*m+A*R,r[9]=v*n+y*l+p*M+A*E,r[10]=v*c+y*f+p*h+A*S,r[11]=v*i+y*d+p*P+A*x,v=a[12],y=a[13],p=a[14],A=a[15],r[12]=v*t+y*s+p*m+A*R,r[13]=v*n+y*l+p*M+A*E,r[14]=v*c+y*f+p*h+A*S,r[15]=v*i+y*d+p*P+A*x,r}function er(r,e,a){var t=a[0],n=a[1],c=a[2],i=Math.hypot(t,n,c),s,l,f;return i<I?null:(i=1/i,t*=i,n*=i,c*=i,s=Math.sin(e),l=Math.cos(e),f=1-l,r[0]=t*t*f+l,r[1]=n*t*f+c*s,r[2]=c*t*f-n*s,r[3]=0,r[4]=t*n*f-c*s,r[5]=n*n*f+l,r[6]=c*n*f+t*s,r[7]=0,r[8]=t*c*f+n*s,r[9]=n*c*f-t*s,r[10]=c*c*f+l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function nr(r,e,a,t,n){var c=1/Math.tan(e/2),i;return r[0]=c/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(i=1/(t-n),r[10]=(n+t)*i,r[14]=2*n*t*i):(r[10]=-1,r[14]=-2*t),r}var tr=nr;function ar(r,e,a,t){var n,c,i,s,l,f,d,m,M,h,P=e[0],R=e[1],E=e[2],S=t[0],x=t[1],v=t[2],y=a[0],p=a[1],A=a[2];return Math.abs(P-y)<I&&Math.abs(R-p)<I&&Math.abs(E-A)<I?rr(r):(d=P-y,m=R-p,M=E-A,h=1/Math.hypot(d,m,M),d*=h,m*=h,M*=h,n=x*M-v*m,c=v*d-S*M,i=S*m-x*d,h=Math.hypot(n,c,i),h?(h=1/h,n*=h,c*=h,i*=h):(n=0,c=0,i=0),s=m*i-M*c,l=M*n-d*i,f=d*c-m*n,h=Math.hypot(s,l,f),h?(h=1/h,s*=h,l*=h,f*=h):(s=0,l=0,f=0),r[0]=n,r[1]=s,r[2]=d,r[3]=0,r[4]=c,r[5]=l,r[6]=m,r[7]=0,r[8]=i,r[9]=f,r[10]=M,r[11]=0,r[12]=-(n*P+c*R+i*E),r[13]=-(s*P+l*R+f*E),r[14]=-(d*P+m*R+M*E),r[15]=1,r)}function j(){var r=new L(3);return L!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function cr(r){var e=r[0],a=r[1],t=r[2];return Math.hypot(e,a,t)}function or(r,e,a){var t=new L(3);return t[0]=r,t[1]=e,t[2]=a,t}function ir(r,e){var a=e[0],t=e[1],n=e[2],c=a*a+t*t+n*n;return c>0&&(c=1/Math.sqrt(c)),r[0]=e[0]*c,r[1]=e[1]*c,r[2]=e[2]*c,r}function sr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function lr(r,e,a){var t=e[0],n=e[1],c=e[2],i=a[0],s=a[1],l=a[2];return r[0]=n*l-c*s,r[1]=c*i-t*l,r[2]=t*s-n*i,r}(function(){var r=j();return function(e,a,t,n,c,i){var s,l;for(a||(a=3),t||(t=0),n?l=Math.min(n*a+t,e.length):l=e.length,s=t;s<l;s+=a)r[0]=e[s],r[1]=e[s+1],r[2]=e[s+2],c(r,r,i),e[s]=r[0],e[s+1]=r[1],e[s+2]=r[2];return e}})();const w=document.getElementById("glCanvas"),o=w.getContext("webgl2");if(!o)throw new Error("WebGL2 not supported");o.enable(o.DEPTH_TEST);const fr=Y(o,o.VERTEX_SHADER,J),hr=Y(o,o.FRAGMENT_SHADER,Q),u=$(o,fr,hr);o.useProgram(u);function dr(r,e,a,t,n,c,i){const s=[],l=[];for(let f=0;f<=e;f++){const d=n+(c-n)*(f/e);for(let m=0;m<=r;m++){const M=a+(t-a)*(m/r),[h,P,R]=i(M,d),E=(d-n)/(c-n),S=.2,x=1-E;s.push(h,P,R,E,S,x,1)}}for(let f=0;f<e;f++)for(let d=0;d<r;d++){const m=f*(r+1),M=(f+1)*(r+1),h=m+d,P=m+d+1,R=M+d,E=M+d+1;l.push(h,P,E,h,E,R)}return{positions:new Float32Array(s),indices:new Uint16Array(l)}}function vr(r=1.5,e=24){const a=[],t=[];for(let n=0;n<=e;n++){const c=n*Math.PI/e;for(let i=0;i<=e;i++){const s=i*2*Math.PI/e,l=r*Math.sin(c)*Math.cos(s),f=r*Math.sin(c)*Math.sin(s),d=r*Math.cos(c);a.push(l,f,d,1,0,0,.3)}}for(let n=0;n<e;n++)for(let c=0;c<e;c++){const i=n*(e+1)+c,s=i+1,l=i+(e+1);t.push(i,s,i,l)}return{positions:new Float32Array(a),indices:new Uint16Array(t)}}const C=dr(100,100,0,2*Math.PI,-2,2,(r,e)=>[1*Math.cos(r)*Math.cosh(e),1*Math.sin(r)*Math.cosh(e),e]),yr=new Float32Array([0,0,0,1,0,0,1,2,0,0,1,0,0,1,0,0,0,0,1,0,1,0,2,0,0,1,0,1,0,0,0,0,0,1,1,0,0,2,0,0,1,1]),pr=new Uint16Array([0,1,2,3,4,5]);function V(r,e){const a=o.createVertexArray(),t=o.createBuffer(),n=o.createBuffer();return o.bindVertexArray(a),o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,r,o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),o.bufferData(o.ELEMENT_ARRAY_BUFFER,e,o.STATIC_DRAW),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,3,o.FLOAT,!1,7*4,0),o.enableVertexAttribArray(1),o.vertexAttribPointer(1,4,o.FLOAT,!1,7*4,3*4),o.bindVertexArray(null),{vao:a,count:e.length}}const U=V(C.positions,C.indices),z=V(yr,pr),B=vr(2.5),D=V(B.positions,B.indices),Ar=o.getUniformLocation(u,"uMVP"),H=g(),q=g(),G=g(),F=g(),b=g();ar(q,[8,2,8],[0,0,0],[0,1,0]);tr(G,Math.PI/4,w.width/w.height,.1,100);const W=1;function K(r,e,a){const t=or(r,e,0),n=r*r+e*e;if(n<=a*a)t[2]=Math.sqrt(a*a-n);else{const c=Math.sqrt(n);t[0]*=a/c,t[1]*=a/c}return t}function k(r){const e=w.getBoundingClientRect(),a=(r.clientX-e.left)/e.width*2-1,t=(e.bottom-r.clientY)/e.height*2-1;return[a,t]}let O=!1,N=!1,T=null;w.addEventListener("mousedown",r=>{O=!0,N=!0;const[e,a]=k(r);T=K(e,a,W)});w.addEventListener("mouseup",()=>{O=!1,N=!1,T=null});w.addEventListener("mousemove",r=>{if(!O||!T)return;const[e,a]=k(r),t=K(e,a,W),n=j();if(lr(n,T,t),cr(n)<1e-5)return;const c=sr(T,t),i=Math.min(1,Math.max(-1,c)),s=Math.acos(i),l=g();ir(n,n),er(l,s,n),_(b,l,b),T=t});function X(){Z(H,b),_(F,q,H),_(F,G,F),o.clearColor(1,1,1,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.useProgram(u),o.uniformMatrix4fv(Ar,!1,F),N&&(o.bindVertexArray(D.vao),o.drawElements(o.LINES,D.count,o.UNSIGNED_SHORT,0)),o.bindVertexArray(z.vao),o.drawElements(o.LINES,z.count,o.UNSIGNED_SHORT,0),o.bindVertexArray(U.vao),o.drawElements(o==null?void 0:o.TRIANGLES,U.count,o.UNSIGNED_SHORT,0),requestAnimationFrame(X)}X();
