import"./modulepreload-polyfill-B5Qt9EMX.js";import{A as y,c as m,l as G,p as q,f as W,m as T,a as K}from"./mat4-DI7TqCbi.js";function g(){var t=new y(3);return y!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function X(t){var r=t[0],e=t[1],o=t[2];return Math.hypot(r,e,o)}function $(t,r,e){var o=new y(3);return o[0]=t,o[1]=r,o[2]=e,o}function J(t,r){var e=r[0],o=r[1],a=r[2],c=e*e+o*o+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=r[0]*c,t[1]=r[1]*c,t[2]=r[2]*c,t}function Q(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function Z(t,r,e){var o=r[0],a=r[1],c=r[2],s=e[0],i=e[1],l=e[2];return t[0]=a*l-c*i,t[1]=c*s-o*l,t[2]=o*i-a*s,t}(function(){var t=g();return function(r,e,o,a,c,s){var i,l;for(e||(e=3),o||(o=0),a?l=Math.min(a*e+o,r.length):l=r.length,i=o;i<l;i+=e)t[0]=r[i],t[1]=r[i+1],t[2]=r[i+2],c(t,t,s),r[i]=t[0],r[i+1]=t[1],r[i+2]=t[2];return r}})();function B(t,r,e){const o=t.createShader(r);if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const a=t.getShaderInfoLog(o);throw t.deleteShader(o),new Error("Shader compile error: "+a)}return o}function tt(t,r,e){const o=t.createProgram();if(t.attachShader(o,r),t.attachShader(o,e),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){const a=t.getProgramInfoLog(o);throw t.deleteProgram(o),new Error("Program link error: "+a)}return o}const rt=`#version 300 es
layout(location=0) in vec3 aPosition;
layout(location=1) in vec4 aColor;

uniform mat4 uMVP;

out vec4 vColor;

void main() {
  gl_Position = uMVP * vec4(aPosition, 1.0);
  vColor = aColor;
}
`,nt=`#version 300 es
precision mediump float;


in vec4 vColor;
out vec4 fColor;

void main() {
  fColor = vColor; 
}
`,h=document.getElementById("glCanvas"),n=h.getContext("webgl2");if(!n)throw new Error("WebGL2 not supported");n.enable(n.DEPTH_TEST);const ot=B(n,n.VERTEX_SHADER,rt),et=B(n,n.FRAGMENT_SHADER,nt),M=tt(n,ot,et);n.useProgram(M);function at(t,r,e,o,a,c,s){const i=[],l=[];for(let u=0;u<=r;u++){const f=a+(c-a)*(u/r);for(let A=0;A<=t;A++){const E=e+(o-e)*(A/t),[p,P,S]=s(E,f),v=(f-a)/(c-a),Y=.2,j=1-v;i.push(p,P,S,v,Y,j,1)}}for(let u=0;u<r;u++)for(let f=0;f<t;f++){const A=u*(t+1),E=(u+1)*(t+1),p=A+f,P=A+f+1,S=E+f,v=E+f+1;l.push(p,P,v,p,v,S)}return{positions:new Float32Array(i),indices:new Uint16Array(l)}}function ct(t=1.5,r=24){const e=[],o=[];for(let a=0;a<=r;a++){const c=a*Math.PI/r;for(let s=0;s<=r;s++){const i=s*2*Math.PI/r,l=t*Math.sin(c)*Math.cos(i),u=t*Math.sin(c)*Math.sin(i),f=t*Math.cos(c);e.push(l,u,f,1,0,0,.3)}}for(let a=0;a<r;a++)for(let c=0;c<r;c++){const s=a*(r+1)+c,i=s+1,l=s+(r+1);o.push(s,i,s,l)}return{positions:new Float32Array(e),indices:new Uint16Array(o)}}const I=at(100,100,0,2*Math.PI,-2,2,(t,r)=>[1*Math.cos(t)*Math.cosh(r),1*Math.sin(t)*Math.cosh(r),r]),it=new Float32Array([0,0,0,1,0,0,1,2,0,0,1,0,0,1,0,0,0,0,1,0,1,0,2,0,0,1,0,1,0,0,0,0,0,1,1,0,0,2,0,0,1,1]),st=new Uint16Array([0,1,2,3,4,5]);function x(t,r){const e=n.createVertexArray(),o=n.createBuffer(),a=n.createBuffer();return n.bindVertexArray(e),n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a),n.bufferData(n.ELEMENT_ARRAY_BUFFER,r,n.STATIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,3,n.FLOAT,!1,7*4,0),n.enableVertexAttribArray(1),n.vertexAttribPointer(1,4,n.FLOAT,!1,7*4,3*4),n.bindVertexArray(null),{vao:e,count:r.length}}const V=x(I.positions,I.indices),F=x(it,st),L=ct(2.5),C=x(L.positions,L.indices),lt=n.getUniformLocation(M,"uMVP"),U=m(),D=m(),N=m(),R=m(),b=m();G(D,[8,2,8],[0,0,0],[0,1,0]);q(N,Math.PI/4,h.width/h.height,.1,100);const O=1;function z(t,r,e){const o=$(t,r,0),a=t*t+r*r;if(a<=e*e)o[2]=Math.sqrt(e*e-a);else{const c=Math.sqrt(a);o[0]*=e/c,o[1]*=e/c}return o}function k(t){const r=h.getBoundingClientRect(),e=(t.clientX-r.left)/r.width*2-1,o=(r.bottom-t.clientY)/r.height*2-1;return[e,o]}let w=!1,_=!1,d=null;h.addEventListener("mousedown",t=>{w=!0,_=!0;const[r,e]=k(t);d=z(r,e,O)});h.addEventListener("mouseup",()=>{w=!1,_=!1,d=null});h.addEventListener("mousemove",t=>{if(!w||!d)return;const[r,e]=k(t),o=z(r,e,O),a=g();if(Z(a,d,o),X(a)<1e-5)return;const c=Q(d,o),s=Math.min(1,Math.max(-1,c)),i=Math.acos(s),l=m();J(a,a),W(l,i,a),T(b,l,b),d=o});function H(){K(U,b),T(R,D,U),T(R,N,R),n.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.useProgram(M),n.uniformMatrix4fv(lt,!1,R),_&&(n.bindVertexArray(C.vao),n.drawElements(n.LINES,C.count,n.UNSIGNED_SHORT,0)),n.bindVertexArray(F.vao),n.drawElements(n.LINES,F.count,n.UNSIGNED_SHORT,0),n.bindVertexArray(V.vao),n.drawElements(n==null?void 0:n.TRIANGLES,V.count,n.UNSIGNED_SHORT,0),requestAnimationFrame(H)}H();
