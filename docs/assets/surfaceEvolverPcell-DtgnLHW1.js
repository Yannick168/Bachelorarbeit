import"./modulepreload-polyfill-B5Qt9EMX.js";import{S as de,P as fe,W as he,o as pe,p as ge,H as ue,f as oe,B as me,F as we,l as te,a as be,b as Me,c as se,L as Fe,d as ve,e as Ee,G as Ie,q as Se,V as Z}from"./three.module-e7rftcMR.js";import{O as xe}from"./OrbitControls-DfK9pJJV.js";const ke="/Bachelorarbeit/assets/pcell_finished-C9W2GnWN.fe",A=new de,b=new fe(45,window.innerWidth/window.innerHeight,.1,1e3);b.position.set(2,2,3);const B=new he({antialias:!0});B.setSize(window.innerWidth,window.innerHeight);B.setClearColor(16777215);B.toneMapping=pe;B.toneMappingExposure=1.6;document.body.appendChild(B.domElement);const _=new xe(b,B.domElement);_.enableDamping=!0;const Ce=new ge(16777215,8,0,2);b.add(Ce);A.add(b);const ce=new ue(16777215,7829367,1);A.add(ce);A.add(new oe(16777215,.2));window.addEventListener("resize",()=>{b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),B.setSize(window.innerWidth,window.innerHeight)});const K=/^(vertices|edges|faces|facets|bodies)\b/i,v=d=>/^[+-]?\d+$/.test(d),U=d=>/^-?\d+$/.test(d),C=d=>/^[+-]?(?:\d*\.\d+|\d+\.?\d*)(?:[eE][+-]?\d+)?$/.test(d),D=d=>d.replace(/\/\*.*?\*\//g,"").trim(),ne=/\(\s*([+-]?(?:\d*\.\d+|\d+\.?\d*)(?:[eE][+-]?\d+)?)\s+([+-]?(?:\d*\.\d+|\d+\.?\d*)(?:[eE][+-]?\d+)?)\s+([+-]?(?:\d*\.\d+|\d+\.?\d*)(?:[eE][+-]?\d+)?)\s*\)/,Ae=/boundary\s+(\d+)/i;function ye(d){const f=d.split(/\r?\n/),l=f.map(t=>t.trim());let u=1,S=.55;for(const t of l){const c=t.match(/^\s*PARAMETER\s+RMAX\s*=\s*([^\s]+)/i);c&&C(c[1])&&(u=parseFloat(c[1]));const n=t.match(/^\s*PARAMETER\s+ZMAX\s*=\s*([^\s]+)/i);n&&C(n[1])&&(S=parseFloat(n[1]))}const a={vertices:[],edges:[],faces:[],facets:[]};for(let t=0;t<l.length;t++)if(K.test(l[t])){const c=l[t].toLowerCase().split(/\s+/)[0];c in a&&a[c].push(t)}const y=t=>{let c=l.length;for(let n=t+1;n<l.length;n++)if(K.test(l[n])){c=n;break}return f.slice(t+1,c)},x=[],p={},k=(t,c,n,r)=>{if(p[t]!==void 0)return;const o=x.length;p[t]=o,x.push([c,n,r])};if(a.vertices.length){const t=y(a.vertices[0]);for(const c of t){if(!c.trim())continue;const n=D(c);if(n){const s=n.split(/\s+/);if(s.length>=4&&v(s[0])&&C(s[1])&&C(s[2])&&C(s[3])){k(parseInt(s[0],10),parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));continue}}const r=c.match(/^\s*(\d+)\b/),o=c.match(ne);if(r&&o){const s=parseInt(r[1],10),h=parseFloat(o[1]),E=parseFloat(o[2]),P=parseFloat(o[3]);k(s,h,E,P);continue}const m=D(c);if(m){const s=m.split(/\s+/);if(s.length>=2&&v(s[0])&&C(s[1])){const h=parseInt(s[0],10),E=parseFloat(s[1]),P=c.match(Ae);if(P){const j=parseInt(P[1],10),z=u*Math.cos(E),I=u*Math.sin(E),L=j===1?S:j===2?-S:0;k(h,z,I,L);continue}}}}}else for(const t of f){if(!t.trim())continue;const n=D(t).split(/\s+/);if(n.length>=4&&v(n[0])&&C(n[1])&&C(n[2])&&C(n[3])){k(parseInt(n[0],10),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));continue}const r=t.match(/^\s*(\d+)\b/),o=t.match(ne);if(r&&o){const m=parseInt(r[1],10);k(m,parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]))}}const T={},H=t=>{for(const c of t){const n=D(c);if(!n)continue;const r=n.split(/\s+/);if(r.length>=3&&v(r[0])&&v(r[1])&&v(r[2])){const o=parseInt(r[0],10),m=parseInt(r[1],10),s=parseInt(r[2],10),h=p[m],E=p[s];if(h===void 0||E===void 0)continue;T[o]=[h,E]}}};if(a.edges.length)for(const t of a.edges)H(y(t));else{const t=a.faces[0]??a.facets[0]??l.length;let c=0;for(let o=t-1;o>=0;o--)if(K.test(l[o])){c=o;break}const n=f.slice(c,t),r=[];for(const o of n){const m=D(o),s=m.split(/\s+/);if(s.length>=3&&v(s[0])&&v(s[1])&&v(s[2])){if(s.length>=4&&v(s[3]))continue;r.push(m)}}H(r)}const F=[],ie=[...a.faces||[],...a.facets||[]];function N(t,c){return`${t}->${c}`}for(const t of ie){const c=y(t);for(const n of c){const r=D(n);if(!r)continue;const o=r.split(/\s+/);if(o.length>=4&&v(o[0])&&U(o[1])&&U(o[2])&&U(o[3])){const m=parseInt(o[0],10),s=[];for(let e=1;e<o.length&&U(o[e]);e++)s.push(parseInt(o[e],10));if(s.length<3)continue;const h=[],E=[];let P=!0;for(const e of s){const i=Math.abs(e),g=T[i];if(!g){P=!1;break}E.push([g[0],g[1]]),h.push(e<0?[g[1],g[0]]:[g[0],g[1]])}if(!P||!h.length)continue;if(s.length===3){const e=[h[0][0],h[1][0],h[2][0]];if(new Set(e).size===3){F.push({faceId:m,edgeIds:s,tris:[e]});continue}}const j=new Set;for(const[e,i]of h)j.add(e),j.add(i);const z=[...j];if(z.length===3){const e=new Map;for(const[w,V]of E)e.has(w)||e.set(w,new Set),e.has(V)||e.set(V,new Set),e.get(w).add(V),e.get(V).add(w);const i=z[0],g=[...e.get(i)??[]];if(g.length!==2)continue;const[$,G]=g,W=new Set(h.map(([w,V])=>N(w,V))),J=[i,$,G],Q=[i,G,$],ee=w=>(W.has(N(w[0],w[1]))?1:0)+(W.has(N(w[1],w[2]))?1:0)+(W.has(N(w[2],w[0]))?1:0);F.push({faceId:m,edgeIds:s,tris:[ee(Q)>ee(J)?Q:J]});continue}const I=new Map,L=new Map,O=new Map;for(const[e,i]of h)I.has(e)||I.set(e,[]),I.get(e).push(i),O.set(e,(O.get(e)??0)+1),L.set(i,(L.get(i)??0)+1),L.has(e)||L.set(e,L.get(e)??0),O.has(i)||O.set(i,O.get(i)??0);let X=z[0];for(const e of z){const i=L.get(e)??0;if((O.get(e)??0)>i){X=e;break}}const M=[X];let R=X;const re=h.length;let le=0;for(;le++<re+5;){const e=I.get(R)??[];if(e.length){const i=e.shift();if(M.push(i),R=i,R===X)break}else{let i=!1;for(const[g,$]of I){const G=$.indexOf(R);if(G>=0){$.splice(G,1),I.has(R)||I.set(R,[]),I.get(R).push(g);const W=g;M.push(W),R=W,i=!0;break}}if(!i)break}}if(M.length>=2&&M[0]===M[M.length-1]&&M.pop(),new Set(M).size<3)continue;const q=[];for(let e=1;e<M.length-1;e++){const i=[M[0],M[e],M[e+1]];new Set(i).size===3&&q.push(i)}if(!q.length)continue;F.push({faceId:m,edgeIds:s,tris:q})}}}let Y=0;for(const t of F)Y+=t.tris.length;return console.group("%cFE-Parser","color:#06b; font-weight:bold;"),console.log("RMAX, ZMAX:",u,S),console.log("Vertices:",x.length),console.log("Edges:",Object.keys(T).length),console.log("Faces (Loops):",F.length,"→ Triangles:",Y),console.groupEnd(),{vertices:x,faces:F,vertexIdToIndex:p}}function Le(d){const f=new me,l=[];for(const k of d.faces)for(const T of k.tris)for(const H of T){const F=d.vertices[H];F&&l.push(F[0],F[1],F[2])}f.setAttribute("position",new we(l,3)),f.computeVertexNormals();const u=new te({color:16711680,side:be,metalness:0,roughness:.35}),S=new te({color:6710886,side:Me,metalness:0,roughness:.35}),a=new se(f,u),y=new se(f,S),x=new Fe(new ve(f),new Ee({color:0})),p=new Ie;return p.add(a,y,x),p}function Re(d){const f=new Se().setFromObject(d),l=f.getSize(new Z),u=f.getCenter(new Z),a=(Math.max(l.x,l.y,l.z)*.6+1e-6)/Math.tan(b.fov*Math.PI/360);b.position.copy(u.clone().add(new Z(a,a,a))),b.near=Math.max(.01,a*.01),b.far=Math.max(1e3,a*10),b.updateProjectionMatrix(),_.target.copy(u),_.update()}async function Be(){const f=new URLSearchParams(location.search).get("fe"),l=f?"/Bachelorarbeit/"+f:ke,u=await fetch(l);if(!u.ok)throw new Error(`Konnte ${l} nicht laden (${u.status})`);const S=await u.text(),a=ye(S);let y=0;for(const p of a.faces)y+=p.tris.length;console.clear(),console.group("%cFE-Daten","color:#0a6; font-weight:bold;"),console.log("Vertices:",a.vertices.length),console.log("Faces (Loops):",a.faces.length,"→ Triangles:",y),console.table(a.faces.slice(0,50).map(p=>({faceId:p.faceId,edges:p.edgeIds.join(" "),tris:p.tris.map(k=>k.join(",")).join(" | ")}))),console.groupEnd();const x=Le({vertices:a.vertices,faces:a.faces});A.clear(),A.add(b),A.add(ce),A.add(new oe(16777215,.2)),A.add(x),Re(x)}Be().catch(d=>console.error(d));function ae(){requestAnimationFrame(ae),_.update(),B.render(A,b)}ae();
