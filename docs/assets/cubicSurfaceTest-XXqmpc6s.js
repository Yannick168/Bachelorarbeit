import"./modulepreload-polyfill-B5Qt9EMX.js";const f=["x^3","y^3","z^3","x^2y","x^2z","y^2z","yz^2","xy^2","xz^2","xyz","x^2","y^2","z^2","xz","xy","yz","x","y","z","1"],S=[["x^3","y^3","z^3","x^2y","x^2z","y^2z","yz^2","xy^2","xz^2","xyz"],["x^2","y^2","z^2","xz","xy","yz"],["x","y","z"],["1"]],T={"x^3":0,"y^3":0,"z^3":0,"x^2y":0,"x^2z":0,"y^2z":0,"yz^2":0,"xy^2":0,"xz^2":0,xyz:0,"x^2":1,"y^2":1,"z^2":1,xz:0,xy:0,yz:0,x:0,y:0,z:0,1:-1},A={sphere:[0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,-1],clebsch:[81,81,81,-189,-189,-189,-189,-189,-189,54,-9,-9,-9,126,126,126,-9,-9,-9,1],cayley:[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,1],monkeySaddle:[1,0,0,0,0,0,0,-3,0,0,0,0,0,0,0,0,0,0,-1,0],cylinder:[0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,-1],crosspropeller:[0,0,0,0,0,0,0,0,0,1,1,.1,0,0,0,0,0,0,0,0],custom:Array(20).fill(0)},z={"x^3":"x^{3}","y^3":"y^{3}","z^3":"z^{3}","x^2y":"x^{2}y","x^2z":"x^{2}z","y^2z":"y^{2}z","yz^2":"y z^{2}","xy^2":"x y^{2}","xz^2":"x z^{2}",xyz:"x y z","x^2":"x^{2}","y^2":"y^{2}","z^2":"z^{2}",xz:"x z",xy:"x y",yz:"y z",x:"x",y:"y",z:"z",1:"1"},v=1e-9,h=[],l=[];function x(r){return typeof r!="string"&&(r=String(r??"")),parseFloat(r.replace(",","."))}const F=r=>Math.abs(r)<v;function y(r){let e=Number(r).toFixed(3).replace(/\.?0+$/,"");return e==="-0"&&(e="0"),e}function P(r,e){const t=Math.abs(r);if(e==="1")return y(t);const n=z[e]||e;return Math.abs(t-1)<v?n:`${y(t)}\\,${n}`}function M(r){return r<420?6:r<640?8:r<900?10:r<1200?12:14}function B(r,e){const t=[];if(f.forEach((s,a)=>{const c=Number(r[a]??0);F(c)||t.push({sign:c<0?"-":"+",body:P(c,s)})}),t.length===0)return"F(x,y,z)=0";const n=[];let o="F(x,y,z) &= ",i=1;o+=t[0].sign==="+"?`${t[0].body}`:`- ${t[0].body}`;for(let s=1;s<t.length;s++)i>=e&&(n.push(o),o="&\\quad ",i=0),o+=t[s].sign==="+"?` + ${t[s].body}`:` - ${t[s].body}`,i++;return o+=" = 0",n.push(o),`\\begin{aligned} ${n.join(" \\\\ ")} \\end{aligned}`}function L(r){return katex.renderToString(z[r]||r,{displayMode:!1,throwOnError:!1})}function I(r){const e=Number(T[r]??0),t=document.createElement("div");t.style.cssText="flex:0 0 9%;max-width:9%;display:flex;flex-direction:column;align-items:center;";const n=document.createElement("div");n.style.cssText="font-size:10px;font-weight:600;text-align:center;margin-bottom:2px;line-height:1.1;",n.innerHTML=L(r);const o=document.createElement("input");o.type="number",o.setAttribute("lang","de"),o.className="form-control form-control-sm",o.style.cssText="width:100%;height:20px;font-size:11px;text-align:center;padding:1px;",o.step="0.1",o.value=String(e);const i=document.createElement("input");i.type="range",i.className="form-range",i.style.cssText="width:100%;height:12px;padding:0;margin:0 0 2px 0;",i.step="0.1",i.min=(e-5).toString(),i.max=(e+5).toString(),i.value=String(e);const s="ticks-"+r;i.setAttribute("list",s);const a=document.createElement("datalist");a.id=s,[i.min,0,i.max].forEach(d=>{const m=document.createElement("option");m.value=d,a.appendChild(m)}),i.addEventListener("input",()=>{o.value=i.value,u()}),o.addEventListener("input",()=>{const d=x(o.value);isFinite(d)&&(i.min=(d-5).toFixed(1),i.max=(d+5).toFixed(1),i.value=String(d),a.innerHTML="",[i.min,0,i.max].forEach(m=>{const g=document.createElement("option");g.value=m,a.appendChild(g)}),u())}),t.append(n,o,i,a);const c=f.indexOf(r);return h[c]=o,l[c]=i,t}function R(){const r=document.getElementById("sliderContainer");r.innerHTML="",S.forEach(e=>{const t=document.createElement("div");t.style.cssText="display:flex;flex-wrap:wrap;justify-content:flex-start;gap:4px;margin-bottom:6px;padding-bottom:8px;",e.forEach(n=>t.appendChild(I(n))),r.appendChild(t)})}function w(){return f.map((r,e)=>{var n;const t=x((n=h[e])==null?void 0:n.value);return isFinite(t)?t:0})}function E(){const r=w(),e=document.getElementById("formulaBox"),t=B(r,M(e.clientWidth)),n=document.getElementById("formulaText");katex.render(t,n,{displayMode:!0,throwOnError:!1})}function C(r=5){for(let e=0;e<f.length;e++){const t=x(h[e].value)||0;l[e].min=(t-r).toFixed(1),l[e].max=(t+r).toFixed(1),l[e].value=String(t);const n="ticks-"+f[e],o=l[e].list||document.getElementById(n);o&&(o.innerHTML="",[l[e].min,0,l[e].max].forEach(i=>{const s=document.createElement("option");s.value=i,o.appendChild(s)}))}}function p(r){const e=A[r];if(Array.isArray(e)){for(let t=0;t<f.length;t++)h[t].value=String(Number(e[t]??0));C(5),u()}}class _{constructor(e){this.canvas=e,this.gl=e.getContext("webgl2"),this.state={coeffs:new Float32Array(20),viewMode:1,showBox:!0},this.initGL(),this.start()}initGL(){const e=this.gl,t=`#version 300 es
    layout(location=0) in vec3 aPos;
    out vec3 vPos;
    uniform mat4 uMVP;
    void main(){ vPos=aPos; gl_Position = uMVP * vec4(aPos,1.0); }`,n=`#version 300 es
    precision highp float;
    in vec3 vPos;
    out vec4 fragColor;
    // TODO: alle benötigten Uniforms
    uniform float uCoeffs[20];
    uniform int uViewMode;
    uniform bool uShowBox;
    // TODO: deine Raycasting-Funktion einfügen (Strahl aufbauen, g(t)=0 lösen, gradF, Shading)
    void main(){
      // Platzhalter-Farbe, damit es sofort etwas zeigt:
      fragColor = vec4(0.1,0.1,0.12,1.0);
    }`,o=this.prog=this.createProgram(t,n);e.useProgram(o),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao);const i=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,3,e.FLOAT,!1,0,0),this.u={uMVP:e.getUniformLocation(o,"uMVP"),uCoeffs:Array.from({length:20},(a,c)=>e.getUniformLocation(o,`uCoeffs[${c}]`)),uViewMode:e.getUniformLocation(o,"uViewMode"),uShowBox:e.getUniformLocation(o,"uShowBox")},e.uniformMatrix4fv(this.u.uMVP,!1,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),this.resize(),window.addEventListener("resize",()=>this.resize())}createProgram(e,t){const n=this.gl,o=this.compile(n.VERTEX_SHADER,e),i=this.compile(n.FRAGMENT_SHADER,t),s=n.createProgram();if(n.attachShader(s,o),n.attachShader(s,i),n.linkProgram(s),!n.getProgramParameter(s,n.LINK_STATUS))throw new Error(n.getProgramInfoLog(s));return n.deleteShader(o),n.deleteShader(i),s}compile(e,t){const n=this.gl,o=n.createShader(e);if(n.shaderSource(o,t),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw new Error(n.getShaderInfoLog(o));return o}resize(){const e=this.gl,t=this.canvas,n=Math.min(window.devicePixelRatio||1,2),o=t.clientWidth|0,i=t.clientHeight|0;(t.width!==o*n||t.height!==i*n)&&(t.width=o*n,t.height=i*n),e.viewport(0,0,t.width,t.height)}update({coeffs:e,viewMode:t,showBox:n}){e&&this.state.coeffs.set(e),t!=null&&(this.state.viewMode=t),n!=null&&(this.state.showBox=!!n);const o=this.gl;o.useProgram(this.prog);for(let i=0;i<20;i++)o.uniform1f(this.u.uCoeffs[i],this.state.coeffs[i]||0);o.uniform1i(this.u.uViewMode,this.state.viewMode|0),o.uniform1i(this.u.uShowBox,this.state.showBox?1:0)}start(){const e=this.gl,t=()=>{e.clearColor(.97,.98,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.useProgram(this.prog),e.bindVertexArray(this.vao),e.drawArrays(e.TRIANGLE_STRIP,0,4),requestAnimationFrame(t)};t()}}let b;function u(){const r=new Float32Array(w()),e=parseInt(document.getElementById("viewMode").value,10),t=document.getElementById("showBox").checked;b.update({coeffs:r,viewMode:e,showBox:t}),E()}function V(){R(),p(document.getElementById("surfaceMode").value),E(),document.getElementById("viewMode").addEventListener("change",u),document.getElementById("surfaceMode").addEventListener("change",r=>{p(r.target.value)}),document.getElementById("showBox").addEventListener("change",u),b=new _(document.getElementById("glCanvas")),u()}(function r(){window.katex&&typeof katex.render=="function"?V():setTimeout(r,50)})();
